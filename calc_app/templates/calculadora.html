<!DOCTYPE html>
{% load static %}
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loginy</title>
    <link rel="stylesheet" href= "{% static 'style/calculadora_style.css' %}">
  </head>

<body>
 <div class= "container-principal">
    <p class="h1">Calculadora Avan√ßada</p>
    <p class="h6">Calculadora com hist√≥rico de opera√ß√µes</p>
    <div class="calculadora-container">
      <form method="post" class="calculadora">
        {% csrf_token %}
        <input id="display" class="display" type="text" name="expressao" value="{{ expressao|default:'0' }}" readonly>
        <div class="botoes">
            <button type="button" class="btn btn-clear">C</button>
            <button type="button" class="btn btn-op">¬±</button>
            <button type="button" class="btn btn-op">%</button>
            <button type="button" class="btn btn-operacao">+</button>

            <button type="button" class="btn btn-num">7</button>
            <button type="button" class="btn btn-num">8</button>
            <button type="button" class="btn btn-num">9</button>
            <button type="button" class="btn btn-operacao">√ó</button>

            <button type="button" class="btn btn-num">4</button>
            <button type="button" class="btn btn-num">5</button>
            <button type="button" class="btn btn-num">6</button>
            <button type="button" class="btn btn-operacao">‚àí</button>

            <button type="button" class="btn btn-num">1</button>
            <button type="button" class="btn btn-num">2</button>
            <button type="button" class="btn btn-num">3</button>
            <button type="button" class="btn btn-operacao">+</button>

            <button type="button" class="btn btn-num zero">0</button>
            <button type="button" class="btn btn-num">.</button>
            <button type="submit" class="btn btn-igual">=</button> <!-- aqui o submit acontece -->
        </div>
</form>

    <div class="historico">
     <h3>
    <i class="far fa-clock"></i> Hist√≥rico
          <form method="post" style="display:inline;">
              {% csrf_token %}
            <input type="hidden" name="limpar_historico" value="limpar_historico">
            <button type="submit" class="btn-limpar" title="Limpar Hist√≥rico">üóëÔ∏è</button>
          </form>
    </h3>
        <div class= "item-historico">
            {% for op in historico_operacoes %}     
                <div>{{ op.parametros }} </div>
                <div> = {{ op.resultado }}</div>   
                <div class="hora">{{ op.dt_inclusao|date:"H:i" }}</div>
          
            {% empty %}
                <li>Nenhuma opera√ß√£o ainda.</li>
            {% endfor %}
        </div>
    </div>
  </div>
</div>

<script>
  // c√≥digo JS Feito com IA - constr√≥i a intera√ß√£o dos bot√µes

    // seleciona por Id
    const display = document.getElementById('display');
    // seleciona por classe 
    const buttons = document.querySelectorAll('.btn');

     // percorre todos os botoes
   buttons.forEach(button => {
    // ignora o bot√£o de envio, n√£o precisamos dele
    if (button.type !== 'submit') {
        // adiciona um evento click e qnd o bot√£o for clicado executa a fun√ß√£o e
        button.addEventListener('click', function(e) {
            // previne comportamento padr√£o de botoes 
            e.preventDefault();

            // descobre a classe do bot√£o clicado
            const btnClass = this.classList;

            if (btnClass.contains('btn-clear')) {
                // faz o display zerar 
                display.value = '0';
            } 
            else if (btnClass.contains('btn-num') || btnClass.contains('btn-operacao') || btnClass.contains('btn-op')) {
                // se o display estiver com 0, substitui pelo n√∫mero ou operador clicado
                if (display.value === '0') {
                    display.value = this.textContent;
                } else {    // se j√° tiver algum valor, acrescenta o que foi clicado (ex: o +, o √ó, ou outro n√∫mero)
                    display.value += this.textContent;
                }
            }
        });
    }
});

</script>
</body>

</html>